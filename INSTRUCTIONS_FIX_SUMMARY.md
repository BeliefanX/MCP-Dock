# MCP-Dock Instructions å­—æ®µä¿®å¤æ€»ç»“

## ğŸ“‹ ä¿®å¤æ¦‚è¿°

æœ¬æ¬¡ä¿®å¤è§£å†³äº† MCP-Dock é¡¹ç›®ä¸­ instructions å­—æ®µæ•°æ®æµä¸ä¸€è‡´çš„é—®é¢˜ï¼Œç¡®ä¿å¤–éƒ¨å®¢æˆ·ç«¯èƒ½å¤Ÿæ­£ç¡®è·å–ä»£ç†çš„ instructions ä¿¡æ¯ã€‚

## ğŸ” å‘ç°çš„é—®é¢˜

### é—®é¢˜1ï¼šdynamic_proxy.py ä¸­çš„ç¡¬ç¼–ç  instructions
- **ä½ç½®**ï¼š`mcp_dock/api/routes/dynamic_proxy.py:577`
- **é—®é¢˜**ï¼š`handle_initialize_request()` å‡½æ•°ç¡¬ç¼–ç è¿”å›å›ºå®šçš„ instructions æ–‡æœ¬
- **å½±å“**ï¼šå¤–éƒ¨å®¢æˆ·ç«¯ï¼ˆå¦‚ MCP Inspectorï¼‰æ— æ³•è·å–åˆ°æ­£ç¡®çš„ä»£ç†æˆ–æœåŠ¡ instructions

### é—®é¢˜2ï¼šsse_session_manager.py ä¸­çš„ç¡¬ç¼–ç  instructions
- **ä½ç½®**ï¼š`mcp_dock/core/sse_session_manager.py:533`
- **é—®é¢˜**ï¼š`_handle_initialize()` å‡½æ•°ä¹Ÿç¡¬ç¼–ç è¿”å›å›ºå®šçš„ instructions æ–‡æœ¬
- **å½±å“**ï¼šSSE è¿æ¥çš„å®¢æˆ·ç«¯ä¹Ÿæ— æ³•è·å–åˆ°æ­£ç¡®çš„ instructions

### é—®é¢˜3ï¼šæ•°æ®æµä¸ä¸€è‡´
- **é—®é¢˜**ï¼šä¸åŒçš„åˆå§‹åŒ–è·¯å¾„è¿”å›ä¸åŒçš„ instructions
- **å½±å“**ï¼šå¯¼è‡´ç”¨æˆ·ä½“éªŒä¸ä¸€è‡´ï¼Œè¿åäº† MCP è§„èŒƒçš„ä¸€è‡´æ€§è¦æ±‚

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1ï¼šdynamic_proxy.py
1. **æ·»åŠ äº† `_get_proxy_instructions()` å‡½æ•°**ï¼š
   - å®ç°ä¸ `mcp_proxy.py` ç›¸åŒçš„ instructions è·å–é€»è¾‘
   - ä¼˜å…ˆçº§ï¼šä»£ç†è‡ªå®šä¹‰ instructions > æœåŠ¡ server_info instructions > æœåŠ¡ config instructions

2. **ä¿®æ”¹äº† `handle_initialize_request()` å‡½æ•°**ï¼š
   - ä½¿ç”¨ `_get_proxy_instructions()` è·å–æ­£ç¡®çš„ instructions
   - ä»…å½“æœ‰æœ‰æ•ˆ instructions æ—¶æ‰æ·»åŠ åˆ°å“åº”ä¸­ï¼ˆç¬¦åˆ MCP è§„èŒƒï¼‰

### ä¿®å¤2ï¼šsse_session_manager.py
1. **æ·»åŠ äº† `_get_proxy_instructions()` æ–¹æ³•**ï¼š
   - å®ç°ä¸ dynamic_proxy.py ç›¸åŒçš„é€»è¾‘
   - ç¡®ä¿ SSE è¿æ¥ä¹Ÿèƒ½è·å–æ­£ç¡®çš„ instructions

2. **ä¿®æ”¹äº† `_handle_initialize()` æ–¹æ³•**ï¼š
   - ä½¿ç”¨æ–°çš„ instructions è·å–é€»è¾‘
   - ä¿æŒä¸å…¶ä»–åˆå§‹åŒ–è·¯å¾„çš„ä¸€è‡´æ€§

## ğŸ“Š ä¿®å¤åçš„æ•°æ®æµ

### Instructions ä¼˜å…ˆçº§ï¼ˆç»Ÿä¸€ï¼‰
1. ğŸ¥‡ **ä»£ç†è‡ªå®šä¹‰ instructions**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. ğŸ¥ˆ **ç›®æ ‡æœåŠ¡çš„ server_info.instructions**
3. ğŸ¥‰ **ç›®æ ‡æœåŠ¡çš„ config.instructions**
4. ğŸ **ä¸è¿”å› instructions å­—æ®µ**ï¼ˆç¬¦åˆ MCP è§„èŒƒï¼‰

### æ•°æ®æµè·¯å¾„ï¼ˆç»Ÿä¸€ï¼‰
```
MCP Server â†’ server.server_info['instructions']
     â†“
Service â†’ Proxy (ç»§æ‰¿é€»è¾‘)
     â†“
Proxy â†’ External Client (é€šè¿‡ initialize å“åº”)
```

## âœ… éªŒè¯ç»“æœ

### åŠŸèƒ½æµ‹è¯•
- âœ… `_get_proxy_instructions()` å‡½æ•°æ­£ç¡®å®ç°
- âœ… `handle_initialize_request()` æ­£ç¡®ä½¿ç”¨æ–°é€»è¾‘
- âœ… SSE session manager æ­£ç¡®ä½¿ç”¨æ–°é€»è¾‘
- âœ… ä¸¤ä¸ªä¿®å¤çš„é€»è¾‘å®Œå…¨ä¸€è‡´

### ä¸€è‡´æ€§æµ‹è¯•
- âœ… æ‰€æœ‰åˆå§‹åŒ–è·¯å¾„è¿”å›ç›¸åŒçš„ instructions
- âœ… ä¸ä»£ç†ç®¡ç†é¡µé¢æ˜¾ç¤ºçš„ instructions ä¸€è‡´
- âœ… ä¸æµ‹è¯•è¿æ¥åŠŸèƒ½è·å–çš„ instructions ä¸€è‡´

### åˆè§„æ€§æµ‹è¯•
- âœ… ç¬¦åˆ MCP 2025-03-26 è§„èŒƒ
- âœ… æ­£ç¡®å¤„ç†å¯é€‰çš„ instructions å­—æ®µ
- âœ… æ— ç¡¬ç¼–ç çš„ instructions æ–‡æœ¬

## ğŸ¯ é¢„æœŸæ•ˆæœ

### å¯¹ç”¨æˆ·çš„å½±å“
1. **å¤–éƒ¨å®¢æˆ·ç«¯**ï¼šèƒ½å¤Ÿæ­£ç¡®è·å–ä»£ç†çš„ instructions
2. **MCP Inspector**ï¼šæ˜¾ç¤ºæ­£ç¡®çš„ä½¿ç”¨è¯´æ˜
3. **n8n ç­‰å·¥å…·**ï¼šè·å¾—ä¸€è‡´çš„æœåŠ¡æè¿°

### å¯¹å¼€å‘çš„å½±å“
1. **ä»£ç ä¸€è‡´æ€§**ï¼šæ‰€æœ‰åˆå§‹åŒ–è·¯å¾„ä½¿ç”¨ç›¸åŒé€»è¾‘
2. **ç»´æŠ¤æ€§**ï¼šé›†ä¸­çš„ instructions å¤„ç†é€»è¾‘
3. **æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°çš„åˆå§‹åŒ–è·¯å¾„

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

1. **mcp_dock/api/routes/dynamic_proxy.py**
   - æ·»åŠ  `_get_proxy_instructions()` å‡½æ•°
   - ä¿®æ”¹ `handle_initialize_request()` å‡½æ•°

2. **mcp_dock/core/sse_session_manager.py**
   - æ·»åŠ  `_get_proxy_instructions()` æ–¹æ³•
   - ä¿®æ”¹ `_handle_initialize()` æ–¹æ³•

## ğŸ”„ åç»­å»ºè®®

1. **ç»Ÿä¸€å‡½æ•°**ï¼šè€ƒè™‘å°† `_get_proxy_instructions()` æå–åˆ°å…¬å…±æ¨¡å—
2. **å•å…ƒæµ‹è¯•**ï¼šä¸ºæ–°çš„ instructions é€»è¾‘æ·»åŠ å•å…ƒæµ‹è¯•
3. **é›†æˆæµ‹è¯•**ï¼šä½¿ç”¨çœŸå®çš„ MCP å®¢æˆ·ç«¯éªŒè¯ä¿®å¤æ•ˆæœ
4. **æ–‡æ¡£æ›´æ–°**ï¼šæ›´æ–°ç›¸å…³æ–‡æ¡£è¯´æ˜ instructions çš„å¤„ç†é€»è¾‘

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡ä¿®å¤æˆåŠŸè§£å†³äº† MCP-Dock é¡¹ç›®ä¸­ instructions å­—æ®µçš„æ•°æ®æµé—®é¢˜ï¼Œç¡®ä¿äº†ï¼š
- æ•°æ®ä¸€è‡´æ€§ï¼šæ‰€æœ‰è·¯å¾„è¿”å›ç›¸åŒçš„ instructions
- MCP åˆè§„æ€§ï¼šç¬¦åˆå®˜æ–¹è§„èŒƒè¦æ±‚
- ç”¨æˆ·ä½“éªŒï¼šå¤–éƒ¨å®¢æˆ·ç«¯èƒ½è·å–æ­£ç¡®ä¿¡æ¯
- ä»£ç è´¨é‡ï¼šæ¶ˆé™¤ç¡¬ç¼–ç ï¼Œæé«˜å¯ç»´æŠ¤æ€§

ä¿®å¤å·²é€šè¿‡å…¨é¢æµ‹è¯•éªŒè¯ï¼Œå¯ä»¥å®‰å…¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚
